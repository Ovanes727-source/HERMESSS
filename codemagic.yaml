workflows:
  android-debug-test:
    name: HERMES Translator Build
    environment:
      groups: []
      vars:
        PACKAGE_NAME: "com.hermes.translator"
        BUILD_NUMBER: 1
        VERSION_NAME: "1.0.0-alpha"
        
    scripts:
      # 0. –§–ò–ö–° –ü–†–ê–í –î–û–°–¢–£–ü–ê (–¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç)
      - name: Fix Permissions
        script: |
          echo "üîß Fixing file permissions..."
          chmod +x ./gradlew
          chmod -R 755 app/src/main/res/font/ 2>/dev/null || true
          echo "‚úÖ Permissions fixed"

      # 1. –°–û–ó–î–ê–¢–¨ –®–†–ò–§–¢–´
      - name: Ensure Fonts Exist
        script: |
          echo "üõ°Ô∏è Ensuring HERMES fonts are present..."
          mkdir -p app/src/main/res/font/
          cd app/src/main/res/font/
          
          # –°–æ–∑–¥–∞—Ç—å XML —Ñ–∞–π–ª—ã
          echo '<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android">
  <font android:font="@font/cinzel_regular" android:fontWeight="400"/>
  <font android:font="@font/cinzel_bold" android:fontWeight="700"/>
</font-family>' > cinzel.xml

          echo '<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android">
  <font android:font="@font/orbitron_regular" android:fontWeight="400"/>
  <font android:font="@font/orbitron_bold" android:fontWeight="700"/>
</font-family>' > orbitron.xml

          echo '<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android">
  <font android:font="@font/rajdhani_light" android:fontWeight="300"/>
  <font android:font="@font/rajdhani_regular" android:fontWeight="400"/>
  <font android:font="@font/rajdhani_medium" android:fontWeight="500"/>
</font-family>' > rajdhani.xml
          
          # –°–∫–∞—á–∞—Ç—å –í–°–ï —à—Ä–∏—Ñ—Ç—ã
          echo "‚¨áÔ∏è Downloading fonts..."
          
          # Cinzel
          curl -s -L -o cinzel_regular.ttf "https://raw.githubusercontent.com/georgiau/cinzel/main/fonts/ttf/Cinzel-Regular.ttf" || true
          curl -s -L -o cinzel_bold.ttf "https://raw.githubusercontent.com/georgiau/cinzel/main/fonts/ttf/Cinzel-Bold.ttf" || true
          
          # Orbitron
          curl -s -L -o orbitron_regular.ttf "https://raw.githubusercontent.com/theleagueof/orbitron/master/fonts/ttf/Orbitron-Regular.ttf" || true
          curl -s -L -o orbitron_bold.ttf "https://raw.githubusercontent.com/theleagueof/orbitron/master/fonts/ttf/Orbitron-Bold.ttf" || true
          
          # Rajdhani
          curl -s -L -o rajdhani_light.ttf "https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Light.ttf" || true
          curl -s -L -o rajdhani_regular.ttf "https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Regular.ttf" || true
          curl -s -L -o rajdhani_medium.ttf "https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Medium.ttf" || true
          
          echo "‚úÖ Fonts ready. Files: $(ls -1 | wc -l)"

      # 2. –ü–û–î–ì–û–¢–û–í–ö–ê GRADLE (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
      - name: Prepare Gradle
        script: |
          echo "‚öôÔ∏è Preparing Gradle..."
          ./gradlew --version || echo "Gradle version check (may fail)"
          echo "‚úÖ Gradle prepared"

      # 3. –°–ë–û–†–ö–ê HERMES
      - name: Build HERMES APK
        script: |
          echo "üî® Building HERMES Translator with ALL features..."
          echo "========================================"
          echo "üöÄ Features included:"
          echo "   ‚Ä¢ System Audio Capture"
          echo "   ‚Ä¢ Real-time Game Overlay"
          echo "   ‚Ä¢ Vosk Offline Recognition"
          echo "   ‚Ä¢ Google ML Kit Translation"
          echo "   ‚Ä¢ PS Remote Play Detection"
          echo "   ‚Ä¢ 4 Translation Modes"
          echo "   ‚Ä¢ 3 Voice Types"
          echo "========================================"
          
          # –°–±–æ—Ä–∫–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞
          ./gradlew clean assembleDebug \
            -PversionCode=$BUILD_NUMBER \
            -PversionName=$VERSION_NAME \
            --stacktrace \
            --no-daemon \
            --console=plain

      # 4. –ü–†–û–í–ï–†–ö–ê
      - name: Verify HERMES Build
        script: |
          echo "üîç Checking build result..."
          APK_PATH=$(find . -name "*.apk" -path "*/debug/*" 2>/dev/null | head -1)
          
          if [ -f "$APK_PATH" ]; then
            echo ""
            echo "üéâüéâüéâ HERMES TRANSLATOR SUCCESSFULLY BUILT! üéâüéâüéâ"
            echo "================================================"
            echo "üì¶ APK: $(basename "$APK_PATH")"
            echo "üìè Size: $(du -h "$APK_PATH" | cut -f1)"
            echo "üî¢ Version: $VERSION_NAME"
            echo ""
            echo "üöÄ READY TO INSTALL ON ANDROID 10+"
            echo "================================================"
          else
            echo "‚ùå HERMES build failed"
            echo "üìÅ Checking what's in font directory:"
            ls -la app/src/main/res/font/ 2>/dev/null || echo "No font directory"
            echo "üîç Looking for APKs:"
            find . -name "*.apk" -type f 2>/dev/null
            exit 1
          fi
    
    artifacts:
      - app/build/outputs/apk/debug/*.apk
      - app/build/outputs/logs/
