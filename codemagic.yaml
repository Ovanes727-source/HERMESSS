workflows:
  android-debug-test:
    name: Hermes Translator - Debug Build
    environment:
      groups: []
      vars:
        PACKAGE_NAME: "com.hermes.translator"
        BUILD_NUMBER: 1
        VERSION_NAME: "1.0.0-alpha"
        
    scripts:
      # 0. Ð¡Ð˜Ð›ÐžÐ™ Ð¡ÐžÐ—Ð”ÐÐÐœ Ð¨Ð Ð˜Ð¤Ð¢Ð« Ð•Ð¡Ð›Ð˜ Ð˜Ð¥ ÐÐ•Ð¢
      - name: FORCE FONT CREATION
        script: |
          echo "ðŸš¨ ENSURING FONT FILES EXIST..."
          
          # 1. Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²ÑÑ‘ ÑÑ‚Ð°Ñ€Ð¾Ðµ (Ñ‡Ð¸ÑÑ‚Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚)
          rm -rf app/src/main/res/font/ 2>/dev/null || true
          
          # 2. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð°Ð¿ÐºÑƒ
          mkdir -p app/src/main/res/font/
          cd app/src/main/res/font/
          
          # 3. Ð¡ÐžÐ—Ð”ÐÐ¢Ð¬ XML Ð¤ÐÐ™Ð›Ð« (Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ)
          echo "ðŸ“ Creating XML font definitions..."
          
          # Cinzel
          cat > cinzel.xml << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto">
    <font android:fontStyle="normal" android:fontWeight="400"
          android:font="@font/cinzel_regular"
          app:fontStyle="normal" app:fontWeight="400"
          app:font="@font/cinzel_regular" />
    <font android:fontStyle="normal" android:fontWeight="700"
          android:font="@font/cinzel_bold"
          app:fontStyle="normal" app:fontWeight="700"
          app:font="@font/cinzel_bold" />
</font-family>
EOF

          # Orbitron
          cat > orbitron.xml << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto">
    <font android:fontStyle="normal" android:fontWeight="400"
          android:font="@font/orbitron_regular"
          app:fontStyle="normal" app:fontWeight="400"
          app:font="@font/orbitron_regular" />
    <font android:fontStyle="normal" android:fontWeight="700"
          android:font="@font/orbitron_bold"
          app:fontStyle="normal" app:fontWeight="700"
          app:font="@font/orbitron_bold" />
</font-family>
EOF

          # Rajdhani
          cat > rajdhani.xml << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto">
    <font android:fontStyle="normal" android:fontWeight="300"
          android:font="@font/rajdhani_light"
          app:fontStyle="normal" app:fontWeight="300"
          app:font="@font/rajdhani_light" />
    <font android:fontStyle="normal" android:fontWeight="400"
          android:font="@font/rajdhani_regular"
          app:fontStyle="normal" app:fontWeight="400"
          app:font="@font/rajdhani_regular" />
    <font android:fontStyle="normal" android:fontWeight="500"
          android:font="@font/rajdhani_medium"
          app:fontStyle="normal" app:fontWeight="500"
          app:font="@font/rajdhani_medium" />
</font-family>
EOF

          echo "âœ… XML files created"
          
          # 4. Ð¡ÐšÐÐ§ÐÐ¢Ð¬ Ð’Ð¡Ð• TTF Ð¤ÐÐ™Ð›Ð«
          echo "â¬‡ï¸ Downloading TTF font files..."
          
          # Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… ÑˆÑ€Ð¸Ñ„Ñ‚Ð¾Ð² Ñ Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¼Ð¸ ÑÑÑ‹Ð»ÐºÐ°Ð¼Ð¸
          declare -A fonts
          fonts=(
            ["cinzel_regular.ttf"]="https://github.com/georgiau/cinzel/raw/main/fonts/ttf/Cinzel-Regular.ttf https://raw.githubusercontent.com/georgiau/cinzel/main/fonts/ttf/Cinzel-Regular.ttf"
            ["cinzel_bold.ttf"]="https://github.com/georgiau/cinzel/raw/main/fonts/ttf/Cinzel-Bold.ttf https://raw.githubusercontent.com/georgiau/cinzel/main/fonts/ttf/Cinzel-Bold.ttf"
            ["orbitron_regular.ttf"]="https://github.com/theleagueof/orbitron/raw/master/fonts/ttf/Orbitron-Regular.ttf https://raw.githubusercontent.com/theleagueof/orbitron/master/fonts/ttf/Orbitron-Regular.ttf"
            ["orbitron_bold.ttf"]="https://github.com/theleagueof/orbitron/raw/master/fonts/ttf/Orbitron-Bold.ttf https://raw.githubusercontent.com/theleagueof/orbitron/master/fonts/ttf/Orbitron-Bold.ttf"
            ["rajdhani_light.ttf"]="https://github.com/IndianTypeFoundry/Rajdhani/raw/master/fonts/ttf/Rajdhani-Light.ttf https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Light.ttf"
            ["rajdhani_regular.ttf"]="https://github.com/IndianTypeFoundry/Rajdhani/raw/master/fonts/ttf/Rajdhani-Regular.ttf https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Regular.ttf"
            ["rajdhani_medium.ttf"]="https://github.com/IndianTypeFoundry/Rajdhani/raw/master/fonts/ttf/Rajdhani-Medium.ttf https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Medium.ttf"
          )
          
          for file in "${!fonts[@]}"; do
            echo "  Downloading: $file"
            urls=(${fonts[$file]})
            
            # ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ Ð¿ÐµÑ€Ð²ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ
            if curl -s -L -o "$file" "${urls[0]}" && [ -s "$file" ]; then
              echo "    âœ… Success"
            else
              # ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ Ð²Ñ‚Ð¾Ñ€ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ
              echo "    âš ï¸  Retrying with alternative URL..."
              curl -s -L -o "$file" "${urls[1]}"
              
              if [ -s "$file" ]; then
                echo "    âœ… Success (alternative)"
              else
                echo "    âŒ FAILED: $file"
                # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿ÑƒÑÑ‚Ð¾Ð¹ Ñ„Ð°Ð¹Ð» Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ±Ð¾Ñ€ÐºÐ° Ð½Ðµ Ð¿Ð°Ð´Ð°Ð»Ð° Ð½Ð° ÑÑ‚Ð¾Ð¼
                touch "$file"
              fi
            fi
          done
          
          # 5. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ
          echo ""
          echo "ðŸ“Š FINAL CHECK:"
          echo "XML files: $(ls *.xml | wc -l) (should be 3)"
          echo "TTF files: $(ls *.ttf | wc -l) (should be 7)"
          echo "Total: $(ls | wc -l) files"
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ€Ð°Ð·Ð¼ÐµÑ€Ñ‹
          echo ""
          echo "ðŸ“ File sizes:"
          for f in *.ttf; do
            size=$(du -h "$f" 2>/dev/null | cut -f1 || echo "0")
            echo "  $f: $size"
          done
          
          cd ../../../../..

      # 1. Gradle Wrapper
      - name: Prepare Gradle Wrapper
        script: |
          chmod +x ./gradlew
          ./gradlew --version

      # 2. Ð¡Ð±Ð¾Ñ€ÐºÐ° HERMES
      - name: Build HERMES APK
        script: |
          echo "ðŸ”¨ Building HERMES Translator APK..."
          echo "========================================"
          echo "ðŸ”„ Features being compiled:"
          echo "   â€¢ System Audio Capture"
          echo "   â€¢ Real-time Game Overlay"
          echo "   â€¢ Offline Speech Recognition"
          echo "   â€¢ PS Remote Play Detection"
          echo "   â€¢ 4 Translation Modes"
          echo "   â€¢ Custom Fonts: Cinzel, Orbitron, Rajdhani"
          echo "========================================"
          
          ./gradlew assembleDebug \
            -PversionCode=$BUILD_NUMBER \
            -PversionName=$VERSION_NAME \
            --stacktrace \
            --no-daemon

      # 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°
      - name: Verify HERMES Build
        script: |
          APK_PATH=$(find . -name "*debug*.apk" | head -1)
          if [ -f "$APK_PATH" ]; then
            echo ""
            echo "ðŸŽ‰ðŸŽ‰ðŸŽ‰ HERMES TRANSLATOR SUCCESSFULLY BUILT! ðŸŽ‰ðŸŽ‰ðŸŽ‰"
            echo "================================================"
            echo "ðŸ“¦ APK: $(basename $APK_PATH)"
            echo "ðŸ“ Size: $(du -h "$APK_PATH" | cut -f1)"
            echo "ðŸ”¢ Version: $VERSION_NAME"
            echo ""
            echo "ðŸš€ READY FOR DEPLOYMENT"
            echo "================================================"
          else
            echo "âŒ HERMES build failed"
            # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼ Ñ‡Ñ‚Ð¾ Ð² Ð¿Ð°Ð¿ÐºÐµ ÑÐ¾ ÑˆÑ€Ð¸Ñ„Ñ‚Ð°Ð¼Ð¸
            echo "ðŸ” Checking font directory:"
            ls -la app/src/main/res/font/ 2>/dev/null || echo "Font directory not found!"
            exit 1
          fi
    
    artifacts:
      - app/build/outputs/apk/debug/*.apk
