workflows:
  android-debug-test:
    name: HERMES Translator Build
    environment:
      groups: []
      vars:
        PACKAGE_NAME: "com.hermes.translator"
        BUILD_NUMBER: 1
        VERSION_NAME: "1.0.0-alpha"
        
    scripts:
      # 0. Ð¤Ð˜ÐšÐ¡ ÐŸÐ ÐÐ’ Ð”ÐžÐ¡Ð¢Ð£ÐŸÐ
      - name: Fix Permissions
        script: |
          echo "ðŸ”§ Fixing file permissions..."
          chmod +x ./gradlew
          chmod -R 755 app/src/main/res/font/ 2>/dev/null || true
          echo "âœ… Permissions fixed"

      # 1. Ð¡ÐžÐ—Ð”ÐÐ¢Ð¬ Ð¨Ð Ð˜Ð¤Ð¢Ð« (Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐ«Ð™ Ð¡Ð˜ÐÐ¢ÐÐšÐ¡Ð˜Ð¡)
      - name: Ensure Fonts Exist
        script: |
          echo "ðŸ›¡ï¸ Ensuring HERMES fonts are present..."
          mkdir -p app/src/main/res/font/
          cd app/src/main/res/font/
          
          # Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ XML Ñ„Ð°Ð¹Ð»Ñ‹ Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ¾Ð¼
          cat > cinzel.xml << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android">
  <font android:font="@font/cinzel_regular" android:fontWeight="400"/>
  <font android:font="@font/cinzel_bold" android:fontWeight="700"/>
</font-family>
EOF

          cat > orbitron.xml << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android">
  <font android:font="@font/orbitron_regular" android:fontWeight="400"/>
  <font android:font="@font/orbitron_bold" android:fontWeight="700"/>
</font-family>
EOF

          cat > rajdhani.xml << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<font-family xmlns:android="http://schemas.android.com/apk/res/android">
  <font android:font="@font/rajdhani_light" android:fontWeight="300"/>
  <font android:font="@font/rajdhani_regular" android:fontWeight="400"/>
  <font android:font="@font/rajdhani_medium" android:fontWeight="500"/>
</font-family>
EOF
          
          # Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð’Ð¡Ð• ÑˆÑ€Ð¸Ñ„Ñ‚Ñ‹
          echo "â¬‡ï¸ Downloading fonts..."
          
          # Cinzel
          curl -s -L -o cinzel_regular.ttf "https://raw.githubusercontent.com/georgiau/cinzel/main/fonts/ttf/Cinzel-Regular.ttf" || true
          curl -s -L -o cinzel_bold.ttf "https://raw.githubusercontent.com/georgiau/cinzel/main/fonts/ttf/Cinzel-Bold.ttf" || true
          
          # Orbitron
          curl -s -L -o orbitron_regular.ttf "https://raw.githubusercontent.com/theleagueof/orbitron/master/fonts/ttf/Orbitron-Regular.ttf" || true
          curl -s -L -o orbitron_bold.ttf "https://raw.githubusercontent.com/theleagueof/orbitron/master/fonts/ttf/Orbitron-Bold.ttf" || true
          
          # Rajdhani
          curl -s -L -o rajdhani_light.ttf "https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Light.ttf" || true
          curl -s -L -o rajdhani_regular.ttf "https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Regular.ttf" || true
          curl -s -L -o rajdhani_medium.ttf "https://raw.githubusercontent.com/IndianTypeFoundry/Rajdhani/master/fonts/ttf/Rajdhani-Medium.ttf" || true
          
          echo "âœ… Fonts ready. Files: $(ls -1 | wc -l)"
          ls -la

      # 2. ÐŸÐžÐ”Ð“ÐžÐ¢ÐžÐ’ÐšÐ GRADLE
      - name: Prepare Gradle
        script: |
          echo "âš™ï¸ Preparing Gradle..."
          ./gradlew --version || echo "Gradle version check"
          echo "âœ… Gradle prepared"

      # 3. Ð¡Ð‘ÐžÐ ÐšÐ HERMES
      - name: Build HERMES APK
        script: |
          echo "ðŸ”¨ Building HERMES Translator with ALL features..."
          echo "========================================"
          echo "ðŸš€ Features included:"
          echo "   â€¢ System Audio Capture"
          echo "   â€¢ Real-time Game Overlay"
          echo "   â€¢ Vosk Offline Recognition"
          echo "   â€¢ Google ML Kit Translation"
          echo "   â€¢ PS Remote Play Detection"
          echo "   â€¢ 4 Translation Modes"
          echo "   â€¢ 3 Voice Types"
          echo "========================================"
          
          ./gradlew clean assembleDebug \
            -PversionCode=$BUILD_NUMBER \
            -PversionName=$VERSION_NAME \
            --stacktrace \
            --no-daemon

      # 4. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ
      - name: Verify HERMES Build
        script: |
          echo "ðŸ” Checking build result..."
          APK_PATH=$(find . -name "*.apk" -path "*/debug/*" 2>/dev/null | head -1)
          
          if [ -f "$APK_PATH" ]; then
            echo ""
            echo "ðŸŽ‰ðŸŽ‰ðŸŽ‰ HERMES TRANSLATOR SUCCESSFULLY BUILT! ðŸŽ‰ðŸŽ‰ðŸŽ‰"
            echo "================================================"
            echo "ðŸ“¦ APK: $(basename "$APK_PATH")"
            echo "ðŸ“ Size: $(du -h "$APK_PATH" | cut -f1)"
            echo "ðŸ”¢ Version: $VERSION_NAME"
            echo ""
            echo "ðŸš€ READY TO INSTALL ON ANDROID 10+"
            echo "================================================"
          else
            echo "âŒ HERMES build failed"
            echo "ðŸ” Debug info:"
            echo "Font dir contents:"
            ls -la app/src/main/res/font/ 2>/dev/null || echo "No font dir"
            echo "Looking for APKs:"
            find . -name "*.apk" -type f 2>/dev/null
            exit 1
          fi
    
    artifacts:
      - app/build/outputs/apk/debug/*.apk
