workflows:
  android-debug-test:
    name: Android Debug Build (Test)
    environment:
      groups: []
      vars:
        PACKAGE_NAME: "com.hermes.translator"
        BUILD_NUMBER: 1
        VERSION_NAME: "1.0.0-alpha"
        
    scripts:
      # 1. –§–ò–ö–° –°–†–ê–ó–£ –í–°–ï–ì–û
      - name: Fix everything at once
        script: |
          echo "üîß ONE-TIME FIX FOR CODEMAGIC..."
          
          # –£–¥–∞–ª—è–µ–º Windows —Ñ–∞–π–ª
          rm -f gradlew.bat
          
          # –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–≤—ã—á–∫–∏ –≤ gradlew
          sed -i '' "s/DEFAULT_JVM_OPTS='\"-Xmx64m\" \"-Xms64m\"'/DEFAULT_JVM_OPTS='-Xmx1024m -Xms256m'/g" gradlew
          
          # –î–∞—ë–º –ø—Ä–∞–≤–∞
          chmod +x ./gradlew
          
          # –°–ö–ê–ß–ò–í–ê–ï–ú GRADLE –í–†–£–ß–ù–£–Æ
          echo "üì¶ Downloading Gradle 8.0..."
          wget -q https://services.gradle.org/distributions/gradle-8.0-bin.zip
          unzip -q gradle-8.0-bin.zip
          mkdir -p ~/.gradle/wrapper/dists/gradle-8.0-bin/
          cp -r gradle-8.0/* ~/.gradle/wrapper/dists/gradle-8.0-bin/
          
          # –¢–ï–°–¢
          echo "üöÄ Testing..."
          ./gradlew --version || {
            echo "‚ùå Still failing, using system gradle..."
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π gradle –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
            gradle --version 2>/dev/null || echo "No system gradle"
          }
      
      # 2. –°–±–æ—Ä–∫–∞ APK
      - name: Build APK
        script: |
          echo "üî® Building APK..."
          ./gradlew assembleDebug \
            -PversionCode=$BUILD_NUMBER \
            -PversionName=$VERSION_NAME \
            --stacktrace \
            --no-daemon
      
      # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞
      - name: Check APK
        script: |
          APK_PATH=$(find . -name "*.apk" -path "*/debug/*" | head -1)
          if [ -f "$APK_PATH" ]; then
            echo "‚úÖ SUCCESS! APK: $APK_PATH"
            echo "üìè Size: $(du -h "$APK_PATH" | cut -f1)"
          else
            echo "‚ùå No APK found"
          fi
    
    artifacts:
      - app/build/outputs/apk/debug/*.apk
    
    publishing:
      email:
        recipients:
          - ovanes931@gmail.com
        notify:
          success: true
          failure: true
