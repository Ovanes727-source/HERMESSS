workflows:
  android-debug-test:
    name: Android Debug Build (Test)
    environment:
      groups: []
      vars:
        PACKAGE_NAME: "com.hermes.translator"
        BUILD_NUMBER: 1
        VERSION_NAME: "1.0.0-alpha"
        
    scripts:
      # üëá –î–û–ë–ê–í–¨–¢–ï –≠–¢–û–¢ –°–ö–†–ò–ü–¢ –í –°–ê–ú–û–ú –ù–ê–ß–ê–õ–ï
      - name: Setup Fonts Directory
        script: |
          echo "üìÅ Creating fonts directory..."
          mkdir -p app/src/main/res/font/
          echo "‚úÖ Fonts directory created"
          ls -la app/src/main/res/ || true

      # üëá –ï–°–õ–ò –§–ê–ô–õ–´ –£–ñ–ï –í –ü–†–û–ï–ö–¢–ï (–≤ –∫–æ—Ä–Ω–µ –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–∞–ø–∫–µ)
      - name: Copy Font Files
        script: |
          echo "üìã Looking for font files..."
          
          # –í–∞—Ä–∏–∞–Ω—Ç A: –ï—Å–ª–∏ —à—Ä–∏—Ñ—Ç—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø–∞–ø–∫–µ fonts/
          if [ -d "fonts/" ]; then
            echo "üìÇ Found fonts/ directory, copying..."
            cp -r fonts/* app/src/main/res/font/ 2>/dev/null || true
          
          # –í–∞—Ä–∏–∞–Ω—Ç B: –ï—Å–ª–∏ —à—Ä–∏—Ñ—Ç—ã –≤ –¥—Ä—É–≥–æ–π –ø–∞–ø–∫–µ
          elif [ -d "assets/fonts/" ]; then
            echo "üìÇ Found assets/fonts/ directory, copying..."
            cp -r assets/fonts/* app/src/main/res/font/ 2>/dev/null || true
          
          # –í–∞—Ä–∏–∞–Ω—Ç C: –ï—Å–ª–∏ —Ñ–∞–π–ª—ã —É–∂–µ –Ω–∞ –º–µ—Å—Ç–µ
          else
            echo "‚ö†Ô∏è  No external font directory found"
            echo "üìù Checking if fonts already in res/font/..."
            ls -la app/src/main/res/font/ || echo "‚ùå res/font/ directory doesn't exist"
          fi
          
          echo "‚úÖ Font copy attempt completed"
          echo "üìä Current font directory contents:"
          ls -la app/src/main/res/font/ 2>/dev/null || echo "No font directory"

      # üëá –ï–°–õ–ò –§–ê–ô–õ–û–í –ù–ï–¢ –í–û–û–ë–©–ï ‚Äî –°–ö–ê–ß–ê–ô–¢–ï –ò–•
      - name: Download Missing Fonts
        script: |
          echo "üåê Downloading missing fonts..."
          
          # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
          mkdir -p app/src/main/res/font/
          
          # –°–∫–∞—á–∏–≤–∞–µ–º Cinzel
          echo "‚¨áÔ∏è  Downloading Cinzel..."
          curl -L -o app/src/main/res/font/cinzel_regular.ttf "https://github.com/georgiau/cinzel/raw/main/fonts/ttf/Cinzel-Regular.ttf" || true
          curl -L -o app/src/main/res/font/cinzel_bold.ttf "https://github.com/georgiau/cinzel/raw/main/fonts/ttf/Cinzel-Bold.ttf" || true
          
          # –°–∫–∞—á–∏–≤–∞–µ–º Orbitron  
          echo "‚¨áÔ∏è  Downloading Orbitron..."
          curl -L -o app/src/main/res/font/orbitron_regular.ttf "https://github.com/theleagueof/orbitron/raw/master/fonts/ttf/Orbitron-Regular.ttf" || true
          curl -L -o app/src/main/res/font/orbitron_bold.ttf "https://github.com/theleagueof/orbitron/raw/master/fonts/ttf/Orbitron-Bold.ttf" || true
          
          # –°–∫–∞—á–∏–≤–∞–µ–º Rajdhani
          echo "‚¨áÔ∏è  Downloading Rajdhani..."
          curl -L -o app/src/main/res/font/rajdhani_light.ttf "https://github.com/IndianTypeFoundry/Rajdhani/raw/master/fonts/ttf/Rajdhani-Light.ttf" || true
          curl -L -o app/src/main/res/font/rajdhani_regular.ttf "https://github.com/IndianTypeFoundry/Rajdhani/raw/master/fonts/ttf/Rajdhani-Regular.ttf" || true
          curl -L -o app/src/main/res/font/rajdhani_medium.ttf "https://github.com/IndianTypeFoundry/Rajdhani/raw/master/fonts/ttf/Rajdhani-Medium.ttf" || true
          
          echo "‚úÖ Fonts downloaded"
          echo "üìä Files in font directory:"
          ls -la app/src/main/res/font/

      # 1. –î–µ–ª–∞–µ–º wrapper –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º (–û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –ö–û–î)
      - name: Prepare Gradle Wrapper
        script: |
          chmod +x ./gradlew
          ./gradlew --version

      # 2. –°–æ–±–∏—Ä–∞–µ–º APK —á–µ—Ä–µ–∑ Gradle Wrapper
      - name: Build APK
        script: |
          echo "üî® Building APK with Gradle Wrapper..."
          ./gradlew assembleDebug \
            -PversionCode=$BUILD_NUMBER \
            -PversionName=$VERSION_NAME \
            --stacktrace \
            --no-daemon

      # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ APK —Å–æ–±—Ä–∞–ª—Å—è
      - name: Check APK
        script: |
          APK_PATH=$(find . -name "*.apk" -path "*/debug/*" | head -1)
          if [ -f "$APK_PATH" ]; then
            echo "üéâ SUCCESS! Hermes Translator APK built!"
            echo "üì¶ File: $APK_PATH"
            echo "üìè Size: $(du -h "$APK_PATH" | cut -f1)"
            
            # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏—á–∞—Ö
            echo ""
            echo "‚ú® HERMES TRANSLATOR FEATURES:"
            echo "   ‚Ä¢ System Audio Capture (Android 10+)"
            echo "   ‚Ä¢ Vosk Offline Speech Recognition"
            echo "   ‚Ä¢ Google ML Kit Translation"
            echo "   ‚Ä¢ Real-time Game Overlay"
            echo "   ‚Ä¢ PS Remote Play Detection"
            echo "   ‚Ä¢ 4 Translation Modes"
            echo "   ‚Ä¢ 3 Voice Types"
          else
            echo "‚ùå No APK found"
            find . -name "*.apk" -type f
            exit 1
          fi
    
    artifacts:
      - app/build/outputs/apk/debug/*.apk
